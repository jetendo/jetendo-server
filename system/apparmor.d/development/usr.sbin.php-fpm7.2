# Last Modified: Sun Jan 26 01:30:15 2014
#include <tunables/global>

/usr/sbin/php-fpm7.2 {

  #include <abstractions/base>
  #include <abstractions/fonts>
  #include <abstractions/nameservice>

  capability chown,
  capability dac_override,
  capability dac_read_search,
  capability kill,
  capability net_admin,
  capability setgid,
  capability setuid,

  signal receive set=kill peer=/usr/sbin/php-fpm7.2,
  signal receive set=term peer=/usr/sbin/php-fpm7.2,
  signal send set=kill peer=/usr/sbin/php-fpm7.2,
  signal send set=term peer=/usr/sbin/php-fpm7.2,

  deny owner /var/jetendo-server/jetendo/public/test1.php r,
  deny owner /var/jetendo-server/jetendo/sites/sq/customizer/system/customizer-library2.php r,

  /bin/dash rix,
  /bin/hostname rix,
  /etc/ImageMagick-6/coder.xml r,
  /etc/ImageMagick-6/colors.xml r,
  /etc/ImageMagick-6/magic.xml r,
  /etc/ImageMagick-6/type.xml r,
  /etc/ImageMagick/*.xml r,
  /etc/mailname r,
  /etc/php/7.2/fpm/conf.d/ r,
  /etc/php/7.2/fpm/php-fpm.conf r,
  /etc/php/7.2/fpm/php.ini r,
  /etc/php/7.2/fpm/pool.d/ r,
  /etc/php/7.2/fpm/pool.d/www.conf r,
  /etc/php/7.2/mods-available/* r,
  /etc/postfix/dynamicmaps.cf r,
  /etc/postfix/main.cf r,
  /etc/ssl/openssl.cnf r,
  /proc/*/auxv r,
  /proc/*/loginuid r,
  /run/php/php7.2-fpm-*.pid w,
  /run/php/php7.2-fpm-*.sock w,
  /run/php/php7.2-fpm.pid w,
  /run/php/php7.2-fpm.sock w,
  /sys/devices/system/cpu/ r,
  /tmp/* rwk,
  /usr/bin/gs rix,
  /usr/lib{,32,64}/** mr,
  /usr/local/lib/libz.so.* mr,
  /usr/sbin/php-fpm7.2 mrw,
  /usr/sbin/postdrop rix,
  /usr/sbin/sendmail rix,
  /usr/share/ImageMagick-*/*.xml r,
  /usr/share/mysql/charsets/Index.xml r,
  /var/jetendo-server/backup/jetendo/share/mls-images/ rw,
  /var/jetendo-server/backup/jetendo/share/mls-images/** rw,
  /var/jetendo-server/jetendo/execute/active/* rw,
  /var/jetendo-server/jetendo/execute/complete/* rw,
  /var/jetendo-server/jetendo/execute/start/* rw,
  /var/jetendo-server/jetendo/phptemp/ rw,
  /var/jetendo-server/jetendo/phptemp/* w,
  /var/jetendo-server/jetendo/phptemp/** rw,
  /var/jetendo-server/jetendo/public/a/content/oauth.php r,
  /var/jetendo-server/jetendo/public/a/content/yelp.php r,
  /var/jetendo-server/jetendo/public/a/host-time.php r,
  /var/jetendo-server/jetendo/public/a/listing/size.php r,
  /var/jetendo-server/jetendo/public/a/secure-message.php r,
  /var/jetendo-server/jetendo/public/index.php r,
  /var/jetendo-server/jetendo/public/mls-images-temp/ w,
  /var/jetendo-server/jetendo/scripts/library.php r,
  /var/jetendo-server/jetendo/share/mls-images-temp/ rw,
  /var/jetendo-server/jetendo/share/mls-images-temp/** rw,
  /var/jetendo-server/jetendo/share/mls-images/ rw,
  /var/jetendo-server/jetendo/share/mls-images/** rw,
  /var/jetendo-server/jetendo/sites-writable/*/client-upload/** rw,
  /var/jetendo-server/jetendo/sites-writable/sq/zupload/** rw,
  /var/jetendo-server/jetendo/sites-writable/sq_zsite_info/** r,
  /var/jetendo-server/jetendo/sites-writable/sq_zsite_info/imagick-temp/** rw,
  /var/jetendo-server/jetendo/sites-writable/sq_zsite_info/zupload/** rw,
  /var/jetendo-server/jetendo/sites/sq/customizer/3d/* r,
  /var/jetendo-server/jetendo/sites/sq/customizer/fonts/** r,
  /var/jetendo-server/jetendo/sites/sq/customizer/system/GenBack.php r,
  /var/jetendo-server/jetendo/sites/sq/customizer/system/GenImage.php r,
  /var/jetendo-server/jetendo/sites/sq/customizer/system/GenPreview.php r,
  /var/jetendo-server/jetendo/sites/sq/customizer/system/GenText.php r,
  /var/jetendo-server/jetendo/sites/sq/customizer/system/Generate.php r,
  /var/jetendo-server/jetendo/sites/sq/customizer/system/InsertImage.php r,
  /var/jetendo-server/jetendo/sites/sq/customizer/system/customizer-library.php r,
  /var/jetendo-server/jetendo/sites/sq/customizer/upload/** r,
  /var/jetendo-server/jetendo/sites/sq_zsite_info/customizer/3d/* r,
  /var/jetendo-server/jetendo/sites/sq_zsite_info/customizer/fonts/** r,
  /var/jetendo-server/jetendo/sites/sq_zsite_info/customizer/system/GenBack.php r,
  /var/jetendo-server/jetendo/sites/sq_zsite_info/customizer/system/GenImage.php r,
  /var/jetendo-server/jetendo/sites/sq_zsite_info/customizer/system/GenPreview.php r,
  /var/jetendo-server/jetendo/sites/sq_zsite_info/customizer/system/GenText.php r,
  /var/jetendo-server/jetendo/sites/sq_zsite_info/customizer/system/Generate.php r,
  /var/jetendo-server/jetendo/sites/sq_zsite_info/customizer/system/InsertImage.php r,
  /var/jetendo-server/jetendo/sites/sq_zsite_info/customizer/system/customizer-library.php r,
  /var/jetendo-server/jetendo/sites/sq_zsite_info/customizer/upload/** r,
  /var/jetendo-server/nginx/sites/ r,
  /var/jetendo-server/nginx/sites/** r,
  /var/jetendo-server/system/php/jetendo.ini r,
  /var/jetendo-server/system/php/pool.d/ r,
  /var/jetendo-server/system/php/pool.d/* r,
  /var/log/php7.2-fpm.log w,
  /var/spool/postfix/maildrop/* rw,
  /zbackup/jetendo/share/mls-images/ rw,
  /zbackup/jetendo/share/mls-images/** rw,
  /zbackup2/jetendo/sites-writable/sq_zsite_info/** r,
  /zbackup2/jetendo/sites-writable/sq_zsite_info/zupload/** rw,
  owner /etc/ImageMagick-6/log.xml r,
  owner /etc/ImageMagick-6/policy.xml r,
  owner /run/php/php7.2-fpm.sock rw,
  owner /run/systemd/notify w,
}
